
import React, { useEffect } from 'react';
import { SelectedPlace } from '@/types/supabase';
import { toast } from 'sonner';
import ItineraryPanel from './ItineraryPanel';
import { ScheduleLoadingIndicator } from './ScheduleLoadingIndicator';
import { useScheduleManagement } from '@/hooks/useScheduleManagement';
import { Button } from '@/components/ui/button';

interface ScheduleGeneratorProps {
  selectedPlaces: SelectedPlace[];
  dates: {
    startDate: Date;
    endDate: Date;
    startTime: string;
    endTime: string;
  } | null;
  startDatetimeLocal: string | null;
  endDatetimeLocal: string | null;
  onClose: () => void;
}

// 사용자 제공 데이터 (테스트용)
const userProvidedLogData = `
--- 4. 일별 경로 계산 시작 ---

--- 처리 중인 요일: Mon ---
  경로 탐색 대상 장소: ['제주국제공항', '맛동산감귤체험농장', '해물통라면 문개항아리 애월해안도로점', '해물통라면 문개항아리 애월해안도로점', '제주순풍해장국 함덕점', '제주순풍해장국 함덕점', '공하우스']
  경로 탐색 대상 NODE_IDs: [4060188202, 4050170700, 4050165900, 4050165900, 4050188400, 4050188400, 4050151700]
  구간 1 경로 탐색: 제주국제공항(4060188202) -> 맛동산감귤체험농장(4050170700)
    경로 발견. 노드 수: 45, 링크 수: 44, 거리: 10321.19m
  구간 2 경로 탐색: 맛동산감귤체험농장(4050170700) -> 해물통라면 문개항아리 애월해안도로점(4050165900)
    경로 발견. 노드 수: 12, 링크 수: 11, 거리: 4290.64m
  구간 3: 해물통라면 문개항아리 애월해안도로점 -> 해물통라면 문개항아리 애월해안도로점 (동일 노드 4050165900). 거리: 0m
  구간 4 경로 탐색: 해물통라면 문개항아리 애월해안도로점(4050165900) -> 제주순풍해장국 함덕점(4050188400)
    경로 발견. 노드 수: 104, 링크 수: 103, 거리: 30387.58m
  구간 5: 제주순풍해장국 함덕점 -> 제주순풍해장국 함덕점 (동일 노드 4050188400). 거리: 0m
  구간 6 경로 탐색: 제주순풍해장국 함덕점(4050188400) -> 공하우스(4050151700)
    경로 발견. 노드 수: 131, 링크 수: 130, 거리: 36147.83m
  Mon요일 경로 계산 완료. 상태: 성공, 총 거리: 81147.24m

--- 처리 중인 요일: Tue ---
  경로 탐색 대상 장소: ['공하우스', '만족한상회 중문점', '만족한상회 중문점', '이레저 버기카 체험장', '이레저 버기카 체험장', '점점', '하귀 보배쌤보리김치와게장', '하귀 보배쌤보리김치와게장', '공하우스']
  경로 탐색 대상 NODE_IDs: [4050151700, 4060023702, 4060023702, 4050157700, 4050157700, 4050176200, 4050166900, 4050166900, 4050151700]
  구간 1 경로 탐색: 공하우스(4050151700) -> 만족한상회 중문점(4060023702)
    경로 발견. 노드 수: 40, 링크 수: 39, 거리: 29473.36m
  구간 2: 만족한상회 중문점 -> 만족한상회 중문점 (동일 노드 4060023702). 거리: 0m
  구간 3 경로 탐색: 만족한상회 중문점(4060023702) -> 이레저 버기카 체험장(4050157700)
    경로 발견. 노드 수: 47, 링크 수: 46, 거리: 31335.82m
  구간 4: 이레저 버기카 체험장 -> 이레저 버기카 체험장 (동일 노드 4050157700). 거리: 0m
  구간 5 경로 탐색: 이레저 버기카 체험장(4050157700) -> 점점(4050176200)
    경로 발견. 노드 수: 104, 링크 수: 103, 거리: 26382.07m
  구간 6 경로 탐색: 점점(4050176200) -> 하귀 보배쌤보리김치와게장(4050166900)
    경로 발견. 노드 수: 91, 링크 수: 90, 거리: 23095.97m
  구간 7: 하귀 보배쌤보리김치와게장 -> 하귀 보배쌤보리김치와게장 (동일 노드 4050166900). 거리: 0m
  구간 8 경로 탐색: 하귀 보배쌤보리김치와게장(4050166900) -> 공하우스(4050151700)
    경로 발견. 노드 수: 29, 링크 수: 28, 거리: 8264.16m
  Tue요일 경로 계산 완료. 상태: 성공, 총 거리: 118551.39m

--- 처리 중인 요일: Wed ---
  경로 탐색 대상 장소: ['공하우스', '함덕흑돼지우돈향 함덕점', '함덕흑돼지우돈향 함덕점', '화조원', '화조원', '반디파스타', '반디파스타', '공하우스']
  경로 탐색 대상 NODE_IDs: [4050151700, 4060007400, 4060007400, 4050159200, 4050159200, 4060007400, 4060007400, 4050151700]
  구간 1 경로 탐색: 공하우스(4050151700) -> 함덕흑돼지우돈향 함덕점(4060007400)
    경로 발견. 노드 수: 34, 링크 수: 33, 거리: 27574.81m
  구간 2: 함덕흑돼지우돈향 함덕점 -> 함덕흑돼지우돈향 함덕점 (동일 노드 4060007400). 거리: 0m
  구간 3 경로 탐색: 함덕흑돼지우돈향 함덕점(4060007400) -> 화조원(4050159200)
    경로 발견. 노드 수: 42, 링크 수: 41, 거리: 20818.02m
  구간 4: 화조원 -> 화조원 (동일 노드 4050159200). 거리: 0m
  구간 5 경로 탐색: 화조원(4050159200) -> 반디파스타(4060007400)
    경로 발견. 노드 수: 29, 링크 수: 28, 거리: 20463.80m
  구간 6: 반디파스타 -> 반디파스타 (동일 노드 4060007400). 거리: 0m
  구간 7 경로 탐색: 반디파스타(4060007400) -> 공하우스(4050151700)
    경로 발견. 노드 수: 48, 링크 수: 47, 거리: 27958.99m
  Wed요일 경로 계산 완료. 상태: 성공, 총 거리: 96815.62m

--- 처리 중인 요일: Thu ---
  경로 탐색 대상 장소: ['공하우스', '딜레탕트 조천함덕점', '호커센터', '호커센터', '고토커피바', '테라도스', '제주국제공항']
  경로 탐색 대상 NODE_IDs: [4050151700, 4050177200, 4050147700, 4050147700, 4050159700, 4050151400, 4060188202]
  구간 1 경로 탐색: 공하우스(4050151700) -> 딜레탕트 조천함덕점(4050177200)
    경로 발견. 노드 수: 124, 링크 수: 123, 거리: 32040.80m
  구간 2 경로 탐색: 딜레탕트 조천함덕점(4050177200) -> 호커센터(4050147700)
    경로 발견. 노드 수: 137, 링크 수: 136, 거리: 41426.74m
  구간 3: 호커센터 -> 호커센터 (동일 노드 4050147700). 거리: 0m
  구간 4 경로 탐색: 호커센터(4050147700) -> 고토커피바(4050159700)
    경로 발견. 노드 수: 17, 링크 수: 16, 거리: 16012.70m
  구간 5 경로 탐색: 고토커피바(4050159700) -> 테라도스(4050151400)
    경로 발견. 노드 수: 13, 링크 수: 12, 거리: 5568.05m
  구간 6 경로 탐색: 테라도스(4050151400) -> 제주국제공항(4060188202)
    경로 발견. 노드 수: 59, 링크 수: 58, 거리: 15966.49m
  Thu요일 경로 계산 완료. 상태: 성공, 총 거리: 111014.78m

--- 최종 경로 요약 (요청하신 형식) --- 

날짜: Mon
  경로 : [4060188202, 4060539403, 4050209101, 4050617801, 4050056400, 4050619001, 4050209001, 4050618001, 4050049800, 4050144200, 4050011502, 4050022901, 4050009500, 4050017100, 4050008400, 4050016500, 4050008100, 4050015900, 4050007800, 4050015700, 4050007500, 4050014901, 4050007001, 4050014902, 4050007000, 4050014300, 4050006900, 4050013700, 4050006600, 4050013500, 4050006400, 4050013200, 4050006300, 4050012700, 4050006100, 4050012100, 4050005900, 4050011900, 4050005700, 4050011300, 4050005500, 4050011100, 4050005300, 4050010900, 4050005100, 4050010501, 4050004901, 4050010502, 4050004900, 4050009900, 4050004700, 4050009500, 4050004500, 4050008900, 4050004300, 4050008300, 4050003800, 4050007103, 4050003801, 4050007102, 4050003802, 4050007101, 4050002902, 4050006102, 4050002901, 4050006101, 4050002900, 4050005704, 4050002703, 4050005705, 4050002702, 4050517100, 4050002701, 4050516700, 4050173100, 4050515100, 4050173000, 4050509500, 4050172700, 4050506300, 4050172300, 4050499900, 4050171800, 4050494300, 4050171300, 4050493100, 4050171100, 4050492100, 4050170700, 4050492200, 4050170400, 4050494800, 4050170300, 4050495200, 4050170100, 4050497900, 4050169200, 4050513900, 4050167900, 4050513700, 4050167700, 4050513300, 4050167500, 4050511900, 4050166400, 4050512000, 4050166100, 4050512800, 4050165800, 4050524800, 4050165900, 4050524900, 4050165800, 4050525000, 4050165700, 4050537300, 4050168100, 4050536600, 4050169400, 4050537400, 4050169501, 4050294101, 4050172906, 4050294103, 4050172905, 4050294102, 4050172903, 4050527900, 4050018600, 4050040700, 4050018400, 4050040600, 4050018300, 4050040200, 4050002902, 4050007201, 4050003802, 4050007202, 4050003801, 4050007203, 4050003800, 4050008400, 4050004300, 4050009000, 4050004500, 4050009600, 4050004700, 4050010000, 4050004900, 4050010601, 4050004901, 4050010602, 4050005100, 4050011000, 4050005300, 4050011200, 4050005500, 4050011400, 4050005700, 4050012000, 4050005900, 4050012200, 4050006100, 4050012800, 4050006300, 4050013100, 4050006400, 4050013600, 4050006600, 4050013800, 4050006900, 4050014400, 4050007000, 4050015001, 4050007001, 4050015002, 4050007500, 4050015800, 4050007800, 4050016000, 4050008100, 4050016600, 4050008400, 4050017200, 4050009500, 4050023001, 4050011502, 4050023002, 4050011500, 4050023801, 4050011501, 4050023802, 4050011700, 4050024800, 4050012400, 4050025601, 4050012201, 4050025602, 4050012200, 4050025401, 4050012202, 4050025402, 4050012100, 4050025000, 4050012000, 4050024400, 4050011800, 4050024201, 4050011801, 4050024202, 4050011900, 4050025200, 4050012300, 4050025800, 4050012500, 4050026000, 4050012600, 4050026200, 4050012700, 4050026601, 4050012801, 4050026602, 4050012800, 4050027000, 4050013400, 4050027601, 4050013800, 4050028600, 4050013900, 4050028800, 4050014100, 4050029200, 4050014200, 4050029401, 4050014201, 4050029402, 4050014400, 4050029600, 4050014500, 4050029801, 4050014601, 4050029802, 4050014600, 4050030000, 4050014700, 4050030400, 4050014800, 4050030200, 4050014900, 4050030600, 4050015000, 4050030800, 4050015100, 4050031200, 4050078800, 4050032001, 4050078900, 4050032003, 4050079500, 4050032004, 4050015500, 4050031600, 4050015400, 4050031300, 4050015700, 4050031701, 4050015701, 4050031702, 4050015204, 4050031703, 4050015203, 4050575601, 4050015208, 4050575604, 4050015207, 4050575602, 4050173603, 4050575603, 4050173602, 4050581600, 4050173700, 4050586200, 4050174100, 4050588000, 4050175400, 4050589000, 4050177700, 4050591800, 4050177800, 4050592200, 4050178400, 4050593900, 4050180200, 4050594500, 4050182100, 4050594900, 4050182900, 4050598000, 4050183600, 4050599400, 4050183800, 4050600700, 4050184700, 4050600200, 4050185200, 4050600800, 4050185800, 4050601200, 4050186900, 4050601800, 4050187900, 4050606000, 4050188000, 4050606400, 4050188200, 4050606800, 4050188400, 4050606900, 4050188200, 4050606500, 4050188000, 4050606100, 4050187900, 4050601900, 4050186900, 4050601300, 4050185800, 4050600900, 4050185200, 4050600300, 4050184700, 4050600600, 4050183800, 4050599500, 4050183600, 4050598100, 4050182900, 4050595000, 4050182100, 4050594600, 4050180200, 4050594000, 4050178400, 4050592300, 4050177800, 4050591900, 4050177700, 4050589100, 4050175400, 4050588100, 4050174100, 4050586300, 4050173700, 4050581700, 4050173601, 4050581701, 4050173604, 4050575701, 4050015206, 4050575704, 4050015209, 4050575702, 4050015202, 4050575703, 4050015205, 4050031802, 4050015701, 4050031801, 4050015700, 4050031400, 4050015400, 4050031500, 4050015500, 4050031903, 4050079500, 4050031904, 4050078900, 4050031901, 4050078800, 4050031100, 4050015100, 4050030700, 4050015000, 4050030500, 4050014900, 4050030100, 4050014800, 4050030300, 4050014700, 4050029900, 4050014600, 4050029702, 4050014601, 4050029701, 4050014500, 4050029500, 4050014400, 4050029302, 4050014201, 4050029301, 4050014200, 4050029100, 4050014100, 4050028700, 4050013900, 4050028500, 4050013800, 4050027501, 4050013400, 4050026900, 4050012800, 4050026502, 4050012801, 4050026501, 4050012700, 4050026100, 4050012600, 4050025900, 4050012500, 4050025700, 4050012300, 4050025100, 4050011900, 4050024101, 4050011801, 4050024102, 4050011800, 4050024300, 4050012000, 4050024900, 4050012100, 4050025302, 4050012202, 4050025301, 4050012200, 4050025502, 4050012201, 4050025501, 4050012400, 4050024700, 4050011700, 4050023702, 4050011501, 4050023701, 4050011500, 4050022902, 4050011502, 4050022901, 4050009500, 4050019500, 4050009800, 4050019900, 4050010000, 4050020100, 4050009900, 4050019700, 4050009700, 4050019100, 4050009300, 4050018503, 4050009301, 4050018504, 4050009002, 4050018505, 4050009001, 4050018501, 4050009000, 4050018700, 4050009400, 4050019300, 4050010100, 4050020502, 4050010401, 4050020501, 4050010400, 4050020900, 4050010600, 4050021702, 4050010801, 4050021701, 4050010800, 4050022101, 4050010802, 4050022102, 4050011000, 4050022500, 4050011100, 4050022300, 4050010900, 4050021300, 4050010200, 4050020300, 4050009600, 4050021504, 4050010503, 4050021503, 4050010502, 4050021502, 4050010501, 4050021505, 4050010504, 4050021506, 4050010500, 4050020702, 4050009201, 4050020701, 4050009200, 4050017900, 4050008600, 4050017500, 4050008500, 4050016702, 4050007901, 4050016701, 4050007900, 4050549500, 4050167400, 4050293600, 4050082800, 4050293300, 4050166900, 4050547600, 4050166600, 4050548300, 4050164400, 4050548100, 4050164300, 4050547900, 4050164000, 4050545700, 4050163300, 4050543900, 4050163000, 4050543700, 4050162900, 4050543300, 4050162800, 4050543100, 4050162700, 4050542700, 4050162200, 4050542100, 4050160700, 4050541700, 4050160400, 4050541500, 4050160300, 4050540700, 4050159100, 4050538700, 4050157700, 4050538500, 4050157500, 4050538300, 4050157400, 4050537700, 4050157200, 4050535900, 4050155100, 4050535700, 4050154700, 4050535100, 4050154400, 4050532700, 4050154200, 4050527700, 4050152800, 4050513100, 4050152000, 4050511100, 4050151600, 4050507100, 4050151200, 4050505100, 4050151300, 4050504600, 4050151700]
  총 이동 거리: 118551.39 m

날짜: Wed
  경로 : [4050151700, 4050504700, 4050151300, 4050504400, 4050151800, 4050502900, 4050152100, 4050480300, 4050153500, 4050460900, 4050153900, 4050451300, 4050155500, 4050432100, 4050157900, 4050430100, 4050157800, 4050425700, 4050157600, 4050421500, 4050157300, 4050419500, 4050157000, 4050418100, 4050156900, 4050415900, 4050156500, 4050414100, 4050156100, 4050409500, 4050155600, 4050407100, 4050155000, 4050406700, 4050154800, 4050403100, 4050154100, 4050398300, 4050153600, 4050395700, 4050153400, 4050389100, 4060121500, 4060210600, 4060121200, 4060434600, 4060121800, 4060420900, 4060121900, 4060413400, 4060122000, 4060365200, 4060045000, 4060052100, 4060044400, 4060055300, 4060008500, 4060017400, 4060008400, 4060017200, 4060008200, 4060016601, 4060008201, 4060016602, 4060008202, 4060016603, 4060007400, 4060016503, 4060008202, 4060016502, 4060008201, 4060016501, 4060008200, 4060017100, 4060008400, 4060017603, 4060008602, 4060017602, 4060008601, 4060017601, 4060008600, 4060018100, 4060008800, 4060018500, 4060009200, 4060019502, 4060009401, 4060369100, 4060121000, 4060369700, 4060120700, 4060372000, 4060120600, 4060372200, 4060120500, 4060373200, 4060120200, 4060376200, 4060118100, 4060411900, 4060117900, 4060428600, 4060118000, 4060432700, 4060118500, 4060442300, 4060118600, 4060443100, 4060118700, 4060444700, 4060119100, 4060454500, 4060119700, 4060460100, 4050152400, 4050386600, 4050152500, 4050386800, 4050152600, 4050391200, 4050153200, 4050395400, 4050153300, 4050396600, 4050153600, 4050398200, 4050154100, 4050403000, 4050154800, 4050406600, 4050155000, 4050407000, 4050155600, 4050409400, 4050156100, 4050414000, 4050156500, 4050415800, 4050156900, 4050418000, 4050157000, 4050419600, 4050157600, 4050425600, 4050157800, 4050429800, 4050158800, 4050432600, 4050159200, 4050432700, 4050158800, 4050431500, 4050158000, 4050429700, 4050157800, 4050425700, 4050157600, 4050421500, 4050157300, 4050419500, 4050157000, 4050418100, 4050156900, 4050415900, 4050156500, 4050414100, 4050156100, 4050409500, 4050155600, 4050407100, 4050155000, 4050406700, 4050154800, 4050403100, 4050154100, 4050398300, 4050153600, 4050395700, 4050153400, 4050389100, 4060121500, 4060210600, 4060121200, 4060434600, 4060121800, 4060420900, 4060121900, 4060413400, 4060122000, 4060365200, 4060045000, 4060052100, 4060044400, 4060055300, 4060008500, 4060017400, 4060008400, 4060017200, 4060008200, 4060016601, 4060008201, 4060016602, 4060008202, 4060016603, 4060007400, 4060016503, 4060008202, 4060016502, 4060008201, 4060016501, 4060008200, 4060017100, 4060008400, 4060017603, 4060008602, 4060017602, 4060008601, 4060017601, 4060008600, 4060018100, 4060008800, 4060018500, 4060009200, 4060019502, 4060009401, 4060369100, 4060121000, 4060369700, 4060120700, 4060372000, 4060120600, 4060372200, 4060120500, 4060373200, 4060120200, 4060376200, 4060118100, 4060411900, 4060117900, 4060428600, 4060118000, 4060432700, 4060118500, 4060442300, 4060118600, 4060443100, 4060118700, 4060444700, 4060119100, 4060454500, 4060119700, 4060460100, 4050152400, 4050386600, 4050152500, 4050386800, 4050152600, 4050391200, 4050153200, 4050395400, 4050153300, 4050396600, 4050153600, 4050398200, 4050154100, 4050403000, 4050154800, 4050406600, 4050155000, 4050407000, 4050155600, 4050409400, 4050156100, 4050414000, 4050156500, 4050415800, 4050156900, 4050418000, 4050157000, 4050419600, 4050157600, 4050425600, 4050157800, 4050430000, 4050157900, 4050432000, 4050155500, 4050451200, 4050153900, 4050460800, 4050153500, 4050480200, 4050152100, 4050502800, 4050151800, 4050504500, 4050151300, 4050504600, 4050151700]
  총 이동 거리: 96815.62 m

날짜: Thu
  경로 : [4050151700, 4050504700, 4050151300, 4050505000, 4050151200, 4050507000, 4050151600, 4050511000, 4050152000, 4050513000, 4050152800, 4050527600, 4050154200, 4050532600, 4050154400, 4050535000, 4050154700, 4050535600, 4050155100, 4050535800, 4050157200, 4050537600, 4050157400, 4050538200, 4050157500, 4050538400, 4050157700, 4050538600, 4050159100, 4050540600, 4050160300, 4050541400, 4050160400, 4050541600, 4050160700, 4050542000, 4050162200, 4050542600, 4050162700, 4050543000, 4050162800, 4050543200, 4050162900, 4050543600, 4050163000, 4050543800, 4050163300, 4050545600, 4050164000, 4050547800, 4050164300, 4050548000, 4050164400, 4050548200, 4050166600, 4050548800, 4050167100, 4050549000, 4050167200, 4050549200, 4050167400, 4050549400, 4050007900, 4050016801, 4050007901, 4050016802, 4050008500, 4050017600, 4050008600, 4050018000, 4050009200, 4050020801, 4050009201, 4050020802, 4050010500, 4050021605, 4050010504, 4050021606, 4050010501, 4050021602, 4050010502, 4050021603, 4050010503, 4050021604, 4050009600, 4050020400, 4050010200, 4050021400, 4050010900, 4050022400, 4050011100, 4050022600, 4050011000, 4050022201, 4050010802, 4050022202, 4050010800, 4050021801, 4050010801, 4050021802, 4050010600, 4050021000, 4050010400, 4050020601, 4050010401, 4050020602, 4050010100, 4050019400, 4050009400, 4050018800, 4050009000, 4050018601, 4050009001, 4050018604, 4050009002, 4050018605, 4050009301, 4050018603, 4050009300, 4050019200, 4050009700, 4050019800, 4050009900, 4050020200, 4050010000, 4050020000, 4050009800, 4050019600, 4050009500, 4050023001, 4050011502, 4050023002, 4050011500, 4050023801, 4050011501, 4050023802, 4050011700, 4050024800, 4050012400, 4050025601, 4050012201, 4050025602, 4050012200, 4050025401, 4050012202, 4050025402, 4050012100, 4050025000, 4050012000, 4050024400, 4050011800, 4050024201, 4050011801, 4050024202, 4050011900, 4050025200, 4050012300, 4050025800, 4050012500, 4050026000, 4050012600, 4050026200, 4050012700, 4050026601, 4050012801, 4050026602, 4050012800, 4050027000, 4050013400, 4050027601, 4050013800, 4050028600, 4050013900, 4050028800, 4050014100, 4050029200, 4050014200, 4050029401, 4050014201, 4050029402, 4050014400, 4050029600, 4050014500, 4050029801, 4050014601, 4050029802, 4050014600, 4050030000, 4050014700, 4050030400, 4050014800, 4050030200, 4050014900, 4050030600, 4050015000, 4050030800, 4050015100, 4050031200, 4050078800, 4050032001, 4050078900, 4050032003, 4050079500, 4050032004, 4050015500, 4050031600, 4050015400, 4050031300, 4050015700, 4050031701, 4050015701, 4050031702, 4050015204, 4050031703, 4050015203, 4050575601, 4050015208, 4050575604, 4050015207, 4050575602, 4050173603, 4050575603, 4050173602, 4050581600, 4050173700, 4050586200, 4050174100, 4050588200, 4050174400, 4050589600, 4050174700, 4050590600, 4050175100, 4050591200, 4050175300, 4050591400, 4050175800, 4050592600, 4050176400, 4050593700, 4050176900, 4050594100, 4050177300, 4050597800, 4050176700, 4050605600, 4050177200, 4050605700, 4050176700, 4050597900, 4050177300, 4050594200, 4050176900, 4050593800, 4050176400, 4050592700, 4050175800, 4050591500, 4050175300, 4050591300, 4050175100, 4050590700, 4050174700, 4050589700, 4050174400, 4050588300, 4050174100, 4050586300, 4050173700, 4050581700, 4050173601, 4050581701, 4050173604, 4050575701, 4050015206, 4050575704, 4050015209, 4050575702, 4050015202, 4050575703, 4050015205, 4050031802, 4050015701, 4050031801, 4050015700, 4050031400, 4050015400, 4050031500, 4050015500, 4050031903, 4050079500, 4050031904, 4050078900, 4050031901, 4050078800, 4050031100, 4050015100, 4050030700, 4050015000, 4050030500, 4050014900, 4050030100, 4050014800, 4050030300, 4050014700, 4050029900, 4050014600, 4050029702, 4050014601, 4050029701, 4050014500, 4050029500, 4050014400, 4050029302, 4050014201, 4050029301, 4050014200, 4050029100, 4050014100, 4050028700, 4050013900, 4050028500, 4050013800, 4050027501, 4050013400, 4050026900, 4050012800, 4050026502, 4050012801, 4050026501, 4050012700, 4050026100, 4050012600, 4050025900, 4050012500, 4050025700, 4050012300, 4050025100, 4050011900, 4050024101, 4050011801, 4050024102, 4050011800, 4050024300, 4050012000, 4050024900, 4050012100, 4050025302, 4050012202, 4050025301, 4050012200, 4050025502, 4050012201, 4050025501, 4050012400, 4050024700, 4050011700, 4050023702, 4050011501, 4050023701, 4050011500, 4050022902, 4050011502, 4050022901, 4050009500, 4050017100, 4050008400, 4050016500, 4050008100, 4050015900, 4050007800, 4050015700, 4050007500, 4050014901, 4050007001, 4050014902, 4050007000, 4050014300, 4050006900, 4050013700, 4050006600, 4050013500, 4050006400, 4050013200, 4050006300, 4050012700, 4050006100, 4050012100, 4050005900, 4050011900, 4050005700, 4050011300, 4050005500, 4050011100, 4050005300, 4050010900, 4050005100, 4050010501, 4050004901, 4050010502, 4050004900, 4050009900, 4050004700, 4050009500, 4050004500, 4050008900, 4050004300, 4050008300, 4050003800, 4050007103, 4050003801, 4050007102, 4050003802, 4050007101, 4050002902, 4050006102, 4050002901, 4050006101, 4050002900, 4050005704, 4050002703, 4050005705, 4050002702, 4050517100, 4050002701, 4050516700, 4050173100, 4050515100, 4050173000, 4050509500, 4050172700, 4050506300, 4050172300, 4050499900, 4050171800, 4050494300, 4050171300, 4050493100, 4050171100, 4050491700, 4050170900, 4050490900, 4050170800, 4050486900, 4050170200, 4050484700, 4050170000, 4050484300, 4050169900, 4050484100, 4050169800, 4050481700, 4050169600, 4050479900, 4050169100, 4050479700, 4050169000, 4050474500, 4050168500, 4050473900, 4050168200, 4050471300, 4050168000, 4050464500, 4050165600, 4050458900, 4050165000, 4050457300, 4050164500, 4050453900, 4050164100, 4050447900, 4050162600, 4050444900, 4050162400, 4050443700, 4050162100, 4050437900, 4050160200, 4050433300, 4050159200, 4050432700, 4050158800, 4050431500, 4050158000, 4050429700, 4050157800, 4050425700, 4050157600, 4050421500, 4050157300, 4050419500, 4050157000, 4050418100, 4050156900, 4050415900, 4050156500, 4050414100, 4050156100, 4050409500, 4050155600, 4050407100, 4050155000, 4050406700, 4050154800, 4050403100, 4050154100, 4050398300, 4050153600, 4050396500, 4050153100, 4050392900, 4050152700, 4050393000, 4050149000, 4050390500, 4050147800, 4050388300, 4050147700, 4050388200, 4050147800, 4050390400, 4050149000, 4050398800, 4050145600, 4050411800, 4050144300, 4050414600, 4050145800, 4050418800, 4050147900, 4050424600, 4050150000, 4050434000, 4050151100, 4050450600, 4050151900, 4050465200, 4050152200, 4050469200, 4050153500, 4050480000, 4050155700, 4050481000, 4050158100, 4050487600, 4050158500, 4050487800, 4050158900, 4050489200, 4050159700, 4050501800, 4050159600, 4050505800, 4050159500, 4050507600, 4050158200, 4050526400, 4050157500, 4050538300, 4050157400, 4050537700, 4050157200, 4050535900, 4050155100, 4050535700, 4050154700, 4050535100, 4050154400, 4050532700, 4050154200, 4050527700, 4050152800, 4050524300, 4050151400, 4050524200, 4050152800, 4050527600, 4050154200, 4050532600, 4050154400, 4050535000, 4050154700, 4050535600, 4050155100, 4050535800, 4050157200, 4050537600, 4050157400, 4050538200, 4050157500, 4050538400, 4050157700, 4050538600, 4050159100, 4050540600, 4050160300, 4050541400, 4050160400, 4050541600, 4050160700, 4050542000, 4050162200, 4050542600, 4050162700, 4050543000, 4050162800, 4050543200, 4050162900, 4050543600, 4050163000, 4050543800, 4050163300, 4050545600, 4050164000, 4050547800, 4050164300, 4050548000, 4050164400, 4050548200, 4050166600, 4050548800, 4050167100, 4050549000, 4050167200, 4050549200, 4050167400, 4050549400, 4050007900, 4050016801, 4050007901, 4050016802, 4050008500, 4050017600, 4050008600, 4050018000, 4050009200, 4050020801, 4050009201, 4050020802, 4050010500, 4050021605, 4050010504, 4050021606, 4050010501, 4050021602, 4050010502, 4050021603, 4050010503, 4050021604, 4050009600, 4050020400, 4050010200, 4050021400, 4050010900, 4050022400, 4050011100, 4050022600, 4050011000, 4050022201, 4050010802, 4050022202, 4050010800, 4050021801, 4050010801, 4050021802, 4050010600, 4050021000, 4050010400, 4050020601, 4050010401, 4050020602, 4050010100, 4050616401, 4050208601, 4050617101, 4050208701, 4050617601, 4050208801, 4050618201, 4050208901, 4050618401, 4050209201, 4050618801, 4050209001, 4050619101, 4050056400, 4050617901, 4050209101, 4060539404, 4060188202]
  총 이동 거리: 111014.78 m
`; // 템플릿 리터럴 닫는 백틱 추가

const ScheduleGenerator: React.FC<ScheduleGeneratorProps> = ({
  selectedPlaces,
  dates,
  startDatetimeLocal,
  endDatetimeLocal,
  onClose,
}) => {
  const {
    itinerary,
    selectedDay,
    isLoading,
    handleSelectDay,
    runScheduleGenerationProcess,
  } = useScheduleManagement({
    selectedPlaces,
    dates,
    startDatetime: startDatetimeLocal,
    endDatetime: endDatetimeLocal,
    manualLogData: userProvidedLogData, // 사용자 제공 데이터 전달
  });

  useEffect(() => {
    // dates, selectedPlaces, startDatetimeLocal, endDatetimeLocal 등이 유효할 때 자동으로 일정 생성 시도
    // 이 컴포넌트가 마운트되거나 관련 props가 변경될 때 useScheduleManagement 훅 내부의 useEffect가 실행됨
    // runScheduleGenerationProcess는 해당 훅 내부에서 manualLogData가 있으면 자동으로 호출됨
    console.log("[ScheduleGenerator] Props received for schedule generation:", {
      selectedPlacesLength: selectedPlaces.length,
      dates,
      startDatetimeLocal,
      endDatetimeLocal,
      hasManualLogData: !!userProvidedLogData,
    });
  }, [selectedPlaces, dates, startDatetimeLocal, endDatetimeLocal]);

  if (isLoading) {
    return <ScheduleLoadingIndicator />; // onClose prop 제거
  }

  if (itinerary && itinerary.length > 0) {
    return (
      <ItineraryPanel
        itinerary={itinerary}
        startDate={dates?.startDate || new Date()}
        selectedDay={selectedDay}
        onSelectDay={handleSelectDay}
        onClose={onClose}
      />
    );
  }

  // 로딩 중도 아니고, 생성된 일정도 없을 때 (예: 초기 상태 또는 오류)
  // 여기서는 사용자가 "일정 생성" 버튼을 누르는 등의 추가 인터랙션을 할 수 있는 UI를 제공하거나
  // 오류 메시지를 표시할 수 있습니다.
  // 현재는 useScheduleManagement 훅이 manualLogData를 이용해 자동으로 일정을 생성하므로,
  // 이 상태는 주로 초기 로딩 완료 후 아직 itinerary가 없거나, 생성 실패 시 나타날 수 있습니다.
  return (
    <div className="p-4">
      <p className="text-center text-gray-500">
        일정 데이터를 처리 중이거나, 생성된 일정이 없습니다.
      </p>
      <Button onClick={onClose} className="mt-4 w-full">닫기</Button>
      {/* 필요하다면 여기에 수동으로 일정 생성을 트리거하는 버튼을 다시 추가할 수 있습니다.
          <Button onClick={runScheduleGenerationProcess} className="mt-4 w-full">
           수동 일정 생성 (테스트)
          </Button>
      */}
    </div>
  );
};

export default ScheduleGenerator;
