import React, { useEffect } from 'react';
import { SelectedPlace } from '@/types/supabase';
import { toast } from 'sonner';
import ItineraryPanel from './ItineraryPanel';
import { ScheduleLoadingIndicator } from './ScheduleLoadingIndicator';
import { useScheduleManagement } from '@/hooks/useScheduleManagement';
import { Button } from '@/components/ui/button';

interface ScheduleGeneratorProps {
  selectedPlaces: SelectedPlace[];
  dates: {
    startDate: Date;
    endDate: Date;
    startTime: string;
    endTime: string;
  } | null;
  startDatetimeLocal: string | null;
  endDatetimeLocal: string | null;
  onClose: () => void;
}

// 사용자 제공 데이터 (테스트용)
const userProvidedLogData = `
--- 4. 일별 경로 계산 시작 ---

--- 처리 중인 요일: Mon ---
  경로 탐색 대상 장소: ['제주국제공항', '맛동산감귤체험농장', '해물통라면 문개항아리 애월해안도로점', '해물통라면 문개항아리 애월해안도로점', '제주순풍해장국 함덕점', '제주순풍해장국 함덕점', '공하우스']
  경로 탐색 대상 NODE_IDs: [4060188202, 4050170700, 4050165900, 4050165900, 4050188400, 4050188400, 4050151700]
  구간 1 경로 탐색: 제주국제공항(4060188202) -> 맛동산감귤체험농장(4050170700)
    경로 발견. 노드 수: 45, 링크 수: 44, 거리: 10321.19m
  구간 2 경로 탐색: 맛동산감귤체험농장(4050170700) -> 해물통라면 문개항아리 애월해안도로점(4050165900)
    경로 발견. 노드 수: 12, 링크 수: 11, 거리: 4290.64m
  구간 3: 해물통라면 문개항아리 애월해안도로점 -> 해물통라면 문개항아리 애월해안도로점 (동일 노드 4050165900). 거리: 0m
  구간 4 경로 탐색: 해물통라면 문개항아리 애월해안도로점(4050165900) -> 제주순풍해장국 함덕점(4050188400)
    경로 발견. 노드 수: 104, 링크 수: 103, 거리: 30387.58m
  구간 5: 제주순풍해장국 함덕점 -> 제주순풍해장국 함덕점 (동일 노드 4050188400). 거리: 0m
  구간 6 경로 탐색: 제주순풍해장국 함덕점(4050188400) -> 공하우스(4050151700)
    경로 발견. 노드 수: 131, 링크 수: 130, 거리: 36147.83m
  Mon요일 경로 계산 완료. 상태: 성공, 총 거리: 81147.24m

--- 처리 중인 요일: Tue ---
  경로 탐색 대상 장소: ['공하우스', '만족한상회 중문점', '만족한상회 중문점', '이레저 버기카 체험장', '이레저 버기카 체험장', '점점', '하귀 보배쌤보리김치와게장', '하귀 보배쌤보리김치와게장', '공하우스']
  경로 탐색 대상 NODE_IDs: [4050151700, 4060023702, 4060023702, 4050157700, 4050157700, 4050176200, 4050166900, 4050166900, 4050151700]
  구간 1 경로 탐색: 공하우스(4050151700) -> 만족한상회 중문점(4060023702)
    경로 발견. 노드 수: 40, 링크 수: 39, 거리: 29473.36m
  구간 2: 만족한상회 중문점 -> 만족한상회 중문점 (동일 노드 4060023702). 거리: 0m
  구간 3 경로 탐색: 만족한상회 중문점(4060023702) -> 이레저 버기카 체험장(4050157700)
    경로 발견. 노드 수: 47, 링크 수: 46, 거리: 31335.82m
  구간 4: 이레저 버기카 체험장 -> 이레저 버기카 체험장 (동일 노드 4050157700). 거리: 0m
  구간 5 경로 탐색: 이레저 버기카 체험장(4050157700) -> 점점(4050176200)
    경로 발견. 노드 수: 104, 링크 수: 103, 거리: 26382.07m
  구간 6 경로 탐색: 점점(4050176200) -> 하귀 보배쌤보리김치와게장(4050166900)
    경로 발견. 노드 수: 91, 링크 수: 90, 거리: 23095.97m
  구간 7: 하귀 보배쌤보리김치와게장 -> 하귀 보배쌤보리김치와게장 (동일 노드 4050166900). 거리: 0m
  구간 8 경로 탐색: 하귀 보배쌤보리김치와게장(4050166900) -> 공하우스(4050151700)
    경로 발견. 노드 수: 29, 링크 수: 28, 거리: 8264.16m
  Tue요일 경로 계산 완료. 상태: 성공, 총 거리: 118551.39m

--- 처리 중인 요일: Wed ---
  경로 탐색 대상 장소: ['공하우스', '함덕흑돼지우돈향 함덕점', '함덕흑돼지우돈향 함덕점', '화조원', '화조원', '반디파스타', '반디파스타', '공하우스']
  경로 탐색 대상 NODE_IDs: [4050151700, 4060007400, 4060007400, 4050159200, 4050159200, 4060007400, 4060007400, 4050151700]
  구간 1 경로 탐색: 공하우스(4050151700) -> 함덕흑돼지우돈향 함덕점(4060007400)
    경로 발견. 노드 수: 34, 링크 수: 33, 거리: 27574.81m
  구간 2: 함덕흑돼지우돈향 함덕점 -> 함덕흑돼지우돈향 함덕점 (동일 노드 4060007400). 거리: 0m
  구간 3 경로 탐색: 함덕흑돼지우돈향 함덕점(4060007400) -> 화조원(4050159200)
    경로 발견. 노드 수: 42, 링크 수: 41, 거리: 20818.02m
  구간 4: 화조원 -> 화조원 (동일 노드 4050159200). 거리: 0m
  구간 5 경로 탐색: 화조원(4050159200) -> 반디파스타(4060007400)
    경로 발견. 노드 수: 29, 링크 수: 28, 거리: 20463.80m
  구간 6 경로 탐색: 반디파스타 -> 반디파스타 (동일 노드 4060007400). 거리: 0m
  구간 7 경로 탐색: 반디파스타(4060007400) -> 공하우스(4050151700)
    경로 발견. 노드 수: 48, 링크 수: 47, 거리: 27958.99m
  Wed요일 경로 계산 완료. 상태: 성공, 총 거리: 96815.62m

--- 처리 중인 요일: Thu ---
  경로 탐색 대상 장소: ['공하우스', '딜레탕트 조천함덕점', '호커센터', '호커센터', '고토커피바', '테라도스', '제주국제공항']
  경로 탐색 대상 NODE_IDs: [4050151700, 4050177200, 4050147700, 4050147700, 4050159700, 4050151400, 4060188202]
  구간 1 경로 탐색: 공하우스(4050151700) -> 딜레탕트 조천함덕점(4050177200)
    경로 발견. 노드 수: 124, 링크 수: 123, 거리: 32040.80m
  구간 2 경로 탐색: 딜레탕트 조천함덕점(4050177200) -> 호커센터(4050147700)
    경로 발견. 노드 수: 137, 링크 수: 136, 거리: 41426.74m
  구간 3: 호커센터 -> 호커센터 (동일 노드 4050147700). 거리: 0m
  구간 4 경로 탐색: 호커센터(4050147700) -> 고토커피바(4050159700)
    경로 발견. 노드 수: 17, 링크 수: 16, 거리: 16012.70m
  구간 5 경로 탐색: 고토커피바(4050159700) -> 테라도스(4050151400)
    경로 발견. 노드 수: 13, 링크 수: 12, 거리: 5568.05m
  구간 6 경로 탐색: 테라도스(4050151400) -> 제주국제공항(4060188202)
    경로 발견. 노드 수: 59, 링크 수: 58, 거리: 15966.49m
  Thu요일 경로 계산 완료. 상태: 성공, 총 거리: 111014.78m

--- 최종 경로 요약 (요청하신 형식) --- 

날짜: Mon
  경로 : [4060188202, 4060539403, 4050209101, 4050617801, 4050056400, 4050619001, 4050209001, 4050618001, 4050049800, 4050144200, 4050011502, 4050022901, 4050009500, 4050017100, 4050008400, 4050016500, 4050008100, 4050015900, 4050007800, 4050015700, 4050007500, 4050015901, 4050007001, 4050014902, 4050007000, 4050014300, 4050006900, 4050013700, 4050006600, 4050013500, 4050006400, 4050013200, 4050006300, 4050012700, 4050006100, 4050012100, 4050005900, 4050011900, 4050005700, 4050011300, 4050005500, 4050011100, 4050005300, 4050010900, 4050005100, 4050010501, 4050004901, 4050010502, 4050004900, 4050009900, 4050004700, 4050009500, 4050004500, 4050008900, 4050004300, 4050008300, 4050003800, 4050007103, 4050003801, 4050007102, 4050003802, 4050007101, 4050002902, 4050006102, 4050002901, 4050006101, 4050002900, 4050005704, 4050002703, 4050005705, 4050002702, 4050517100, 4050002701, 4050516700, 4050173100, 4050515100, 4050173000, 4050509500, 4050172700, 4050506300, 4050172300, 4050499900, 4050171800, 4050494300, 4050171300, 4050493100, 4050171100, 4050492100, 4050170700, 4050492200, 4050170400, 4050494800, 4050170300, 4050495200, 4050170100, 4050497900, 4050169200, 4050513900, 4050167900, 4050513700, 4050167700, 4050513300, 4050167500, 4050511900, 4050166400, 4050512000, 4050166100, 4050512800, 4050165800, 4050524800, 4050165900, 4050524900, 4050165800, 4050525000, 4050165700, 4050537300, 4050168100, 4050536600, 4050169400, 4050537400, 4050169501, 4050294101, 4050172906, 4050294103, 4050172905, 4050294102, 4050172903, 4050527900, 4050018600, 4050040700, 4050018400, 4050040600, 4050018300, 4050040200, 4050002902, 4050007201, 4050003802, 4050007202, 4050003801, 4050007203, 4050003800, 4050008400, 4050004300, 4050009000, 4050004500, 4050009600, 4050004700, 4050010000, 4050004900, 4050010601, 4050004901, 4050010602, 4050005100, 4050011000, 4050005300, 4050011200, 4050005500, 4050011400, 4050005700, 4050012000, 4050005900, 4050012200, 4050006100, 4050012800, 4050006300, 4050013100, 4050006400, 4050013600, 4050006600, 4050013800, 4050006900, 4050014400, 4050007000, 4050015001, 4050007001, 4050015002, 4050007500, 4050015800, 4050007800, 4050016000, 4050008100, 4050016600, 4050008400, 4050017200, 4050009500, 4050023001, 4050011502, 4050023002, 4050011500, 4050023801, 4050011501, 4050023802, 4050011700, 4050024800, 4050012400, 4050025601, 4050012201, 4050025602, 4050012200, 4050025401, 4050012202, 4050025402, 4050012100, 4050025000, 4050012000, 4050024400, 4050011800, 4050024201, 4050011801, 4050024202, 4050011900, 4050025200, 4050012300, 4050025800, 4050012500, 4050026000, 4050012600, 4050026200, 4050012700, 4050026601, 4050012801, 4050026602, 4050012800, 4050027000, 4050013400, 4050027601, 4050013800, 4050028600, 4050013900, 4050028800, 4050014100, 4050029200, 4050014200, 4050029401, 4050014201, 4050029402, 4050014400, 4050029600, 4050014500, 4050029801, 4050014601, 4050029802, 4050014600, 4050030000, 4050014700, 4050030400, 4050014800, 4050030200, 4050014900, 4050030600, 4050015000, 4050030800, 4050015100, 4050031200, 4050078800, 4050032001, 4050078900, 4050032003, 4050079500, 4050032004, 4050015500, 4050031600, 4050015400, 4050031300, 4050015700, 4050031701, 4050015701, 4050031702, 4050015204, 4050031703, 4050015203, 4050575601, 4050015208, 4050575604, 4050015207, 4050575602, 4050173603, 4050575603, 4050173602, 4050581600, 4050173700, 4050586200, 4050174100, 4050588000, 4050175400, 4050589000, 4050177700, 4050591800, 4050177800, 4050592200, 4050178400, 4050593900, 4050180200, 4050594500, 4050182100, 4050594900, 4050182900, 4050598000, 4050183600, 4050599400, 4050183800, 4050600700, 4050184700, 4050600200, 4050185200, 4050600800, 4050185800, 4050601200, 4050186900, 4050601800, 4050187900, 4050606000, 4050188000, 4050606400, 4050188200, 4050606800, 4050188400, 4050606900, 4050188200, 4050606500, 4050188000, 4050606100, 4050187900, 4050601900, 4050186900, 4050601300, 4050185800, 4050600900, 4050185200, 4050600300, 4050184700, 4050600600, 4050183800, 4050599500, 4050183600, 4050598100, 4050182900, 4050595000, 4050182100, 4050594600, 4050180200, 4050594000, 4050178400, 4050592300, 4050177800, 4050591900, 4050177700, 4050589100, 4050175400, 4050588100, 4050174100, 4050586300, 4050173700, 4050581700, 4050173601, 4050581701, 4050173604, 4050575701, 4050015206, 4050575704, 4050015209, 4050575702, 4050015202, 4050575703, 4050015205, 4050031802, 4050015701, 4050031801, 4050015700, 4050031400, 4050015400, 4050031500, 4050015500, 4050031903, 4050079500, 4050031904, 4050078900, 4050031901, 4050078800, 4050031100, 4050015100, 4050030700, 4050015000, 4050030500, 4050014900, 4050030100, 4050014800, 4050030300, 4050014700, 4050029900, 4050014600, 4050029702, 4050014601, 4050029701, 4050014500, 4050029500, 4050014400, 4050029302, 4050014201, 4050029301, 4050014200, 4050029100, 4050014100, 4050028700, 4050013900, 4050028500, 4050013800, 4050027501, 4050013400, 4050026900, 4050012800, 4050026502, 4050012801, 4050026501, 4050012700, 4050026100, 4050012600, 4050025900, 4050012500, 4050025700, 4050012300, 4050025100, 4050011900, 4050024101, 4050011801, 4050024102, 4050011800, 4050024300, 40
